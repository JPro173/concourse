resources:
- name: project
  type: git
  source:
    uri: https://github.com/JPro173/concourse.git
- name: build-artifact
  type: docker-image
  source:
    repository: injectyy/counter
    username: injectyy
    password: {{ pk }}
    tag: latest


jobs:
- name: deploy-project
  plan:
  - get: project
    trigger: true
  - task: test
    file: project/ci/tasks/test.yml
  - put: build-artifact
    params:
      tag: latest
  - task: build
    file: project/ci/tasks/build.yml
  - task: deploy
    file: project/ci/tasks/deploy.yml
    params:
        PASSWORD: {{password}}
        HOST: {{host}}
        PORT: {{port}}
  - task: smoke-test
    file: project/ci/tasks/smoke_test.yml
