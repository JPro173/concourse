resources:
- name: project
  type: git
  source:
    uri: https://github.com/JPro173/concourse.git
- name: build-artifact
  type: docker-image
  source:
    repository: injectyy/counter
    tag: latest
    username: injectyy
    password: {{password}}


jobs:
- name: deploy-project
  plan:
  - get: project
    trigger: true
  - task: test
    file: project/ci/tasks/test.yml
  - get: build-artifact
    params:
      build: .
      cache: true
  - task: build
    file: project/ci/tasks/build.yml
  - put: build-artifact
  - task: deploy
    file: project/ci/tasks/deploy.yml
    params:
        PK: {{pk}}
        HOST: {{host}}
        PORT: {{port}}
  - task: smoke-test
    file: project/ci/tasks/smoke_test.yml
